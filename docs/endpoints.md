# Apple Auth Endpoints

## Get Authorization URL

- Authorization URL is used to redirect to Apple's Authorization Server to request consent from resource owner.
- Query Parameters:
    - `state` (JSON object)
    - `redirect_url`
- Response will contain the same object along with state `identifier`

```
GET {BASE_URL}/auth/apple/auth-url
```

**Example:**

**Request**

```
GET {BASE_URL}/auth/apple/auth-url?state={"redirect_to":"login"}&redirect_url="https://example.com/apple/auth/callback"
```

**Response**

`status: 200 OK`

```json
{
    "authorization_url": "https://appleid.apple.com/auth/authorize?client_id=signin.com.dev.example.Example&redirect_uri=https://example.com/auth/apple/token&state={%22identifier%22:%20%22L21RBCKL4XP%22,%20%22fe_redirect_url%22:%20%22https://example.com/apple/auth/callback%22,%20%22redirect_to%22:%20%22login%22}&response_type=code&response_mode=form_post&scope=name%20email"
}
```

## Authorize User

- Exchange authorization code for access token and talk to resource server with access token and fetch user's profile information.

**Note:**

- After successful authorization, the callback will have the authorization code and state.
- We can fetch `code` from redirect URI query parameters and pass it to Authorize API.

```
POST {BASE_URL}/auth/apple/authorize
```

**Example:**

**Request**

```json
{
  "code": "ce10a4c14aae348b0b3bab1d0a9388f0bA1541ufpZ0R1C1x98Ev1w"
}

```

**Response**

`status: 200 OK`

```
Response needs to be defined by overriding the AppleAuthResponseHandler class
```

## Authorize iOS Token

- Verifies an ID Token issued by Apple's authorization server and fetch user details from decoded token.

```
POST {BASE_URL}/auth/apple/authorize/ios
```

**Example:**

**Request**

```json
{
  "id_token": "<id_token generated by apple>"
}
```

**Response**
```
"Response needs to be defined by overriding the AppleAuthResponseHandler class""
```
